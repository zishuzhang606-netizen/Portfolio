<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>流动渐变绘画板</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 图标组件（SVG）
        const Paintbrush = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m14.622 17.897-10.68-2.913"></path>
                <path d="M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"></path>
                <path d="M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"></path>
            </svg>
        );

        const Eraser = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"></path>
                <path d="M22 21H7"></path>
                <path d="m5 11 9 9"></path>
            </svg>
        );

        const Undo = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 7v6h6"></path>
                <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path>
            </svg>
        );

        const Trash2 = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 6h18"></path>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                <line x1="10" x2="10" y1="11" y2="17"></line>
                <line x1="14" x2="14" y1="11" y2="17"></line>
            </svg>
        );

        function App() {
            const [mousePosition, setMousePosition] = useState({ x: 50, y: 50 });
            const [isDrawing, setIsDrawing] = useState(false);
            const [lines, setLines] = useState([]);
            const [currentLine, setCurrentLine] = useState([]);
            const [brushColor, setBrushColor] = useState('#FF0000');
            const [brushWidth, setBrushWidth] = useState(5);
            const [isEraser, setIsEraser] = useState(false);
            const canvasRef = useRef(null);

            const predefinedColors = [
                '#FF0000', '#FF7F00', '#FFFF00', '#00FF00', 
                '#0000FF', '#4B0082', '#9400D3', '#FF1493'
            ];

            useEffect(() => {
                const handleMouseMove = (e) => {
                    const x = (e.clientX / window.innerWidth) * 100;
                    const y = (e.clientY / window.innerHeight) * 100;
                    setMousePosition({ x, y });
                };

                window.addEventListener('mousemove', handleMouseMove);
                return () => window.removeEventListener('mousemove', handleMouseMove);
            }, []);

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                lines.forEach((line) => {
                    if (line.points.length < 2) return;

                    ctx.strokeStyle = line.color;
                    ctx.lineWidth = line.width;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';

                    ctx.beginPath();
                    ctx.moveTo(line.points[0].x, line.points[0].y);

                    for (let i = 1; i < line.points.length; i++) {
                        ctx.lineTo(line.points[i].x, line.points[i].y);
                    }

                    ctx.stroke();
                });

                if (currentLine.length > 1) {
                    ctx.strokeStyle = isEraser ? '#FFFFFF' : brushColor;
                    ctx.lineWidth = isEraser ? brushWidth * 3 : brushWidth;
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';

                    ctx.beginPath();
                    ctx.moveTo(currentLine[0].x, currentLine[0].y);

                    for (let i = 1; i < currentLine.length; i++) {
                        ctx.lineTo(currentLine[i].x, currentLine[i].y);
                    }

                    ctx.stroke();
                }
            }, [lines, currentLine, brushColor, brushWidth, isEraser]);

            useEffect(() => {
                const handleResize = () => {
                    const canvas = canvasRef.current;
                    if (!canvas) return;
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };

                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            const startDrawing = (e) => {
                setIsDrawing(true);
                setCurrentLine([{ x: e.clientX, y: e.clientY }]);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                setCurrentLine((prev) => [...prev, { x: e.clientX, y: e.clientY }]);
            };

            const stopDrawing = () => {
                if (isDrawing && currentLine.length > 1) {
                    setLines((prev) => [
                        ...prev,
                        {
                            points: currentLine,
                            color: isEraser ? '#FFFFFF' : brushColor,
                            width: isEraser ? brushWidth * 3 : brushWidth,
                        },
                    ]);
                }
                setIsDrawing(false);
                setCurrentLine([]);
            };

            const undo = () => {
                setLines((prev) => prev.slice(0, -1));
            };

            const clearCanvas = () => {
                setLines([]);
            };

            const hue1 = Math.floor((mousePosition.x / 100) * 360);
            const hue2 = Math.floor((mousePosition.y / 100) * 360);
            const hue3 = Math.floor(((mousePosition.x + mousePosition.y) / 200) * 360);

            const gradientStyle = {
                background: `
                    radial-gradient(
                        circle at ${mousePosition.x}% ${mousePosition.y}%, 
                        hsl(${hue1}, 80%, 60%) 0%, 
                        transparent 50%
                    ),
                    radial-gradient(
                        circle at ${100 - mousePosition.x}% ${100 - mousePosition.y}%, 
                        hsl(${hue2}, 75%, 55%) 0%, 
                        transparent 50%
                    ),
                    linear-gradient(
                        ${mousePosition.x * 3.6}deg, 
                        hsl(${hue3}, 70%, 50%) 0%, 
                        hsl(${(hue3 + 60) % 360}, 65%, 45%) 50%,
                        hsl(${(hue3 + 120) % 360}, 70%, 50%) 100%
                    )
                `,
                transition: 'background 0.3s ease-out',
            };

            return (
                <div className="min-h-screen w-full relative" style={gradientStyle}>
                    <canvas
                        ref={canvasRef}
                        onMouseDown={startDrawing}
                        onMouseMove={draw}
                        onMouseUp={stopDrawing}
                        onMouseLeave={stopDrawing}
                        className="absolute top-0 left-0 w-full h-full cursor-crosshair"
                        style={{ pointerEvents: 'auto' }}
                    />

                    <div className="absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-black/70 backdrop-blur-md rounded-full px-6 py-3 shadow-2xl z-10 pointer-events-auto">
                        <div className="flex items-center gap-4">
                            <button
                                onClick={() => setIsEraser(false)}
                                className={`p-2 rounded-full transition-all ${
                                    !isEraser 
                                        ? 'bg-blue-500 text-white' 
                                        : 'text-white/60 hover:text-white'
                                }`}
                                title="画笔"
                            >
                                <Paintbrush className="w-4 h-4" />
                            </button>
                            <button
                                onClick={() => setIsEraser(true)}
                                className={`p-2 rounded-full transition-all ${
                                    isEraser 
                                        ? 'bg-blue-500 text-white' 
                                        : 'text-white/60 hover:text-white'
                                }`}
                                title="橡皮擦"
                            >
                                <Eraser className="w-4 h-4" />
                            </button>

                            <div className="w-px h-6 bg-white/30"></div>

                            {!isEraser && (
                                <div className="flex gap-1.5">
                                    {predefinedColors.map((color) => (
                                        <button
                                            key={color}
                                            onClick={() => setBrushColor(color)}
                                            className={`w-6 h-6 rounded-full transition-all ${
                                                brushColor === color 
                                                    ? 'ring-2 ring-white scale-110' 
                                                    : 'hover:scale-110'
                                            }`}
                                            style={{ backgroundColor: color }}
                                            title={color}
                                        />
                                    ))}
                                    <input
                                        type="color"
                                        value={brushColor}
                                        onChange={(e) => setBrushColor(e.target.value)}
                                        className="w-6 h-6 rounded-full cursor-pointer"
                                        title="自定义颜色"
                                    />
                                </div>
                            )}

                            <div className="w-px h-6 bg-white/30"></div>

                            <div className="flex items-center gap-2">
                                <input
                                    type="range"
                                    min="1"
                                    max="50"
                                    value={brushWidth}
                                    onChange={(e) => setBrushWidth(Number(e.target.value))}
                                    className="w-20"
                                />
                                <span className="text-xs text-white w-6">{brushWidth}</span>
                            </div>

                            <div className="w-px h-6 bg-white/30"></div>

                            <button
                                onClick={undo}
                                disabled={lines.length === 0}
                                className="p-2 text-white/60 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed transition-all"
                                title="撤回"
                            >
                                <Undo className="w-4 h-4" />
                            </button>
                            <button
                                onClick={clearCanvas}
                                disabled={lines.length === 0}
                                className="p-2 text-red-400 hover:text-red-300 disabled:opacity-30 disabled:cursor-not-allowed transition-all"
                                title="清空画布"
                            >
                                <Trash2 className="w-4 h-4" />
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
